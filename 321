task.spawn(function()
    local Players = game:GetService("Players")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local UserInputService = game:GetService("UserInputService")
    local TweenService = game:GetService("TweenService")
    local RunService = game:GetService("RunService")
    local Workspace = game:GetService("Workspace")
    
    local localPlayer = Players.LocalPlayer
    
    if not localPlayer.Character then
        localPlayer.CharacterAdded:Wait()
    end
    task.wait(0.5)
    
    local function findRemoteExact()
        local Packages = ReplicatedStorage:WaitForChild("Packages", 5)
        if Packages then
            local Net = Packages:WaitForChild("Net", 5)
            if Net then
                local remote = Net:FindFirstChild("RE/352aad5B-c786-4998-886b-3e4fa390721e")
                if remote and remote:IsA("RemoteEvent") then return remote end
                for _, obj in pairs(Net:GetChildren()) do
                    if obj:IsA("RemoteEvent") and obj.Name:lower() == "re/352aad5b-c786-4998-886b-3e4fa390721e" then
                        return obj
                    end
                end
            end
        end
        for _, obj in pairs(game:GetDescendants()) do
            if obj:IsA("RemoteEvent") and obj.Name:lower():find("352aad5") then
                return obj
            end
        end
        return nil
    end
    
    local NetRemote
    local remoteReady = false
    
    task.spawn(function()
        local maxWait = 10
        local elapsed = 0
        
        while elapsed < maxWait and not remoteReady do
            NetRemote = findRemoteExact()
            
            if NetRemote and NetRemote:IsA("RemoteEvent") then
                remoteReady = true
                warn("✅ Admin remote found!")
                break
            end
            
            elapsed = elapsed + 0.1
            task.wait(0.1)
        end
        
        if not remoteReady then
            warn("❌ Admin remote not found after " .. maxWait .. " seconds")
        end
    end)
    
    local antiTPScamEnabled = false
    local antiTPLastDefenseTime = 0
    local antiTPCooldown = 3
    local antiTPDistanceThreshold = 15
    
    local myPlot = nil
    local myPlotAnimalPodiums = {}
    local myDisplayName = localPlayer.DisplayName
    
    local function findMyPlot()
        local plotsFolder = Workspace:FindFirstChild("Plots")
        if not plotsFolder then
            warn("❌ Plots folder not found in Workspace!")
            return nil
        end
        
        for _, plot in pairs(plotsFolder:GetChildren()) do
            local plotSign = plot:FindFirstChild("PlotSign")
            if plotSign then
                local surfaceGui = plotSign:FindFirstChild("SurfaceGui")
                if surfaceGui then
                    local frame = surfaceGui:FindFirstChild("Frame")
                    if frame then
                        local textLabel = frame:FindFirstChild("TextLabel")
                        if textLabel and textLabel:IsA("TextLabel") then
                            local plotText = textLabel.Text
                            if plotText:find(myDisplayName) and plotText:find("'s Base") then
                                return plot
                            end
                        end
                    end
                end
            end
        end
        
        warn("❌ Could not find plot belonging to: " .. myDisplayName)
        return nil
    end
    
    local function getMyPlotAnimalPodiums(plot)
        local podiumPositions = {}
        
        local animalPodiumsFolder = plot:FindFirstChild("AnimalPodiums")
        if not animalPodiumsFolder then
            warn("❌ AnimalPodiums folder not found in plot: " .. plot.Name)
            return podiumPositions
        end
        
        for i = 1, 10 do
            local podium = animalPodiumsFolder:FindFirstChild(tostring(i))
            if podium and podium:IsA("Model") then
                podiumPositions[i] = podium:GetPivot().Position
            end
        end
        
        local count = 0
        for _ in pairs(podiumPositions) do count = count + 1 end
        
        if count == 0 then
            warn("⚠️ No AnimalPodiums found in plot: " .. plot.Name)
        end
        
        return podiumPositions
    end
    
    local stealRemote
    local stealingDetected = false
    
    local autoDefenseEnabled = false
    local lastDefenseTime = 0
    local defenseCooldown = 3
    
    local selectedPlayers = {}
    local selectedSet = {}
    local selectedUserIds = {}
    local executionCount = 0
    
    local function getPlayerHead(plr)
        local char = plr.Character
        if not char then return nil end
        return char:FindFirstChild("Head")
    end
    
    local function getPlayerRootPart(plr)
        local char = plr.Character
        if not char then return nil end
        return char:FindFirstChild("HumanoidRootPart")
    end
    
    local function findClosestPlayerToPosition(position)
        local closestPlayer
        local closestDist = math.huge

        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= localPlayer then
                local head = getPlayerHead(plr)
                if head then
                    local dist = (head.Position - position).Magnitude
                    if dist < closestDist then
                        closestDist = dist
                        closestPlayer = plr
                    end
                end
            end
        end

        return closestPlayer
    end
    
    task.spawn(function()
        local function locateStealRemote()
            local packages = ReplicatedStorage:FindFirstChild("Packages")
            if not packages then return nil end
            
            local net = packages:FindFirstChild("Net")
            if not net then return nil end
            
            return net:FindFirstChild("RE/NotificationService/Notify")
        end
        
        local maxAttempts = 10
        for i = 1, maxAttempts do
            stealRemote = locateStealRemote()
            if stealRemote then
                break
            end
            task.wait(0.5)
        end
        
        if stealRemote then
            stealRemote.OnClientEvent:Connect(function(msg)
                if typeof(msg) ~= "string" then return end
                if not msg:find("Someone is stealing your") then return end

                local myChar = localPlayer.Character
                if not myChar then return end

                local myHead = myChar:FindFirstChild("Head")
                if not myHead then return end

                local stealer = findClosestPlayerToPosition(myHead.Position)
                if stealer then
                    stealingDetected = true
                end
            end)
        end
    end)
    
    task.spawn(function()
        task.wait(2)
        myPlot = findMyPlot()
        if myPlot then
            myPlotAnimalPodiums = getMyPlotAnimalPodiums(myPlot)
        end
    end)
    
    task.spawn(function()
        while true do
            if antiTPScamEnabled and remoteReady and myPlot and #myPlotAnimalPodiums > 0 then
                for _, plr in ipairs(Players:GetPlayers()) do
                    if plr ~= localPlayer and plr.Character then
                        local targetRoot = getPlayerRootPart(plr)
                        if targetRoot then
                            local playerPos = targetRoot.Position
                            
                            for podiumNumber, podiumPos in pairs(myPlotAnimalPodiums) do
                                local distance = (playerPos - podiumPos).Magnitude
                                if distance < antiTPDistanceThreshold then
                                    if (tick() - antiTPLastDefenseTime) > antiTPCooldown then
                                        for _, cmd in ipairs({"balloon", "inverse", "rocket", "tiny"}) do
                                            NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", plr, cmd)
                                            task.wait(0.05)
                                        end
                                        
                                        antiTPLastDefenseTime = tick()
                                        break
                                    end
                                end
                            end
                        end
                    end
                end
            end
            task.wait(0.1)
        end
    end)
    
    task.spawn(function()
        while true do
            if autoDefenseEnabled and #selectedPlayers > 0 and stealingDetected and remoteReady then
                stealingDetected = false
                
                if (tick() - lastDefenseTime) > defenseCooldown then
                    local validPlayers = {}
                    for _, plr in ipairs(selectedPlayers) do
                        if plr and plr.Parent == Players then
                            table.insert(validPlayers, plr)
                        end
                    end
                    
                    if #validPlayers > 0 then
                        executionCount = executionCount + 1
                        local effectIndex = (executionCount - 1) % 3 + 1
                        
                        if #validPlayers == 1 then
                            if effectIndex == 1 then
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", validPlayers[1], "balloon")
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", validPlayers[1], "jail")
                            elseif effectIndex == 2 then
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", validPlayers[1], "ragdoll")
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", validPlayers[1], "inverse")
                            elseif effectIndex == 3 then
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", validPlayers[1], "rocket")
                            end
                        elseif #validPlayers >= 2 then
                            local p1, p2 = validPlayers[1], validPlayers[2]
                            
                            if effectIndex == 1 then
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "balloon")
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "jail")
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "ragdoll")
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "inverse")
                            elseif effectIndex == 2 then
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "ragdoll")
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "inverse")
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "balloon")
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "jail")
                            elseif effectIndex == 3 then
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "rocket")
                                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "rocket")
                            end
                        end
                        
                        lastDefenseTime = tick()
                    end
                end
            end
            
            task.wait(0.05)
        end
    end)
    
    local activeGradients = {}
    local function registerGradient(gradient)
        table.insert(activeGradients, gradient)
    end
    
    local animationAngle = 0
    RunService.Heartbeat:Connect(function(dt)
        animationAngle = (animationAngle + (dt * 180)) % 360
        for i = #activeGradients, 1, -1 do
            local grad = activeGradients[i]
            if grad and grad.Parent then
                grad.Rotation = animationAngle
            else
                table.remove(activeGradients, i)
            end
        end
    end)
    
    local function addAnimatedStroke(frame, thickness)
        local stroke = Instance.new("UIStroke")
        stroke.Name = "AnimatedStroke"
        stroke.Color = Color3.fromRGB(255, 255, 255)
        stroke.Thickness = thickness or 3
        stroke.Transparency = 0
        stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        stroke.Parent = frame

        local gradient = Instance.new("UIGradient")
        gradient.Parent = stroke
        gradient.Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 0),
            NumberSequenceKeypoint.new(0.5, 0.8),
            NumberSequenceKeypoint.new(1, 0)
        })
        
        registerGradient(gradient)
        return stroke
    end
    
    local playerGui = localPlayer:WaitForChild("PlayerGui")
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "AdminCardGui"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = playerGui
    
    local outer = Instance.new("Frame")
    outer.Name = "Outer"
    outer.Size = UDim2.new(0, 240, 0, 270)
    outer.Position = UDim2.new(1, -260, 0, 80)
    outer.BackgroundTransparency = 1
    outer.Parent = screenGui

    local outerCorner = Instance.new("UICorner")
    outerCorner.CornerRadius = UDim.new(0, 12)
    outerCorner.Parent = outer

    local card = Instance.new("Frame")
    card.Name = "Card"
    card.Size = UDim2.new(1, -12, 1, -12)
    card.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    card.BackgroundTransparency = 0.1
    card.BorderSizePixel = 0
    card.Parent = outer

    local cardCorner = Instance.new("UICorner")
    cardCorner.CornerRadius = UDim.new(0, 12)
    cardCorner.Parent = card

    local cardStroke = addAnimatedStroke(card, 3)

    local topLeftAccent = Instance.new("Frame")
    topLeftAccent.Name = "TopLeftAccent"
    topLeftAccent.Size = UDim2.new(1, 0, 0, 60)
    topLeftAccent.BackgroundColor3 = Color3.fromRGB(40, 40, 48)
    topLeftAccent.BackgroundTransparency = 0.1
    topLeftAccent.BorderSizePixel = 0
    topLeftAccent.Parent = card

    local topLeftAccentCorner = Instance.new("UICorner")
    topLeftAccentCorner.CornerRadius = UDim.new(0, 12)
    topLeftAccentCorner.Parent = topLeftAccent

    local titleStroke = addAnimatedStroke(topLeftAccent, 2)

    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Parent = topLeftAccent
    title.BackgroundTransparency = 1
    title.Position = UDim2.new(0, 18, 0, 8)
    title.Size = UDim2.new(1, -36, 0, 26)
    title.Text = "Brainrot Protection"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextXAlignment = Enum.TextXAlignment.Left

    local plotStatus = Instance.new("TextLabel")
    plotStatus.Name = "PlotStatus"
    plotStatus.Parent = topLeftAccent
    plotStatus.BackgroundTransparency = 1
    plotStatus.Position = UDim2.new(0, 18, 0, 30)
    plotStatus.Size = UDim2.new(1, -36, 0, 24)
    plotStatus.Text = ""
    plotStatus.Font = Enum.Font.Gotham
    plotStatus.TextSize = 10
    plotStatus.TextColor3 = Color3.fromRGB(180, 180, 180)
    plotStatus.TextXAlignment = Enum.TextXAlignment.Left

    local toggleFrame = Instance.new("Frame")
    toggleFrame.Name = "ToggleFrame"
    toggleFrame.Size = UDim2.new(1, -24, 0, 32)
    toggleFrame.Position = UDim2.new(0, 12, 0, 72)
    toggleFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    toggleFrame.BackgroundTransparency = 0.1
    toggleFrame.BorderSizePixel = 0
    toggleFrame.Parent = card

    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 8)
    toggleCorner.Parent = toggleFrame

    local toggleLabel = Instance.new("TextLabel")
    toggleLabel.Name = "ToggleLabel"
    toggleLabel.Parent = toggleFrame
    toggleLabel.BackgroundTransparency = 1
    toggleLabel.Position = UDim2.new(0, 12, 0, 0)
    toggleLabel.Size = UDim2.new(1, -60, 1, 0)
    toggleLabel.Text = "Auto-Defense"
    toggleLabel.Font = Enum.Font.GothamBold
    toggleLabel.TextSize = 13
    toggleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    toggleLabel.TextXAlignment = Enum.TextXAlignment.Left

    local toggleButton = Instance.new("TextButton")
    toggleButton.Name = "ToggleButton"
    toggleButton.Parent = toggleFrame
    toggleButton.Size = UDim2.new(0, 50, 0, 24)
    toggleButton.Position = UDim2.new(1, -58, 0.5, -12)
    toggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 68)
    toggleButton.Text = ""
    toggleButton.BorderSizePixel = 0

    local toggleBtnCorner = Instance.new("UICorner")
    toggleBtnCorner.CornerRadius = UDim.new(0, 12)
    toggleBtnCorner.Parent = toggleButton

    local toggleIndicator = Instance.new("Frame")
    toggleIndicator.Name = "Indicator"
    toggleIndicator.Parent = toggleButton
    toggleIndicator.Size = UDim2.new(0, 20, 0, 20)
    toggleIndicator.Position = UDim2.new(0, 2, 0, 2)
    toggleIndicator.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
    toggleIndicator.BorderSizePixel = 0

    local indicatorCorner = Instance.new("UICorner")
    indicatorCorner.CornerRadius = UDim.new(0, 10)
    indicatorCorner.Parent = toggleIndicator

    local antiTPToggleFrame = Instance.new("Frame")
    antiTPToggleFrame.Name = "AntiTPToggleFrame"
    antiTPToggleFrame.Size = UDim2.new(1, -24, 0, 32)
    antiTPToggleFrame.Position = UDim2.new(0, 12, 0, 114)
    antiTPToggleFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    antiTPToggleFrame.BackgroundTransparency = 0.1
    antiTPToggleFrame.BorderSizePixel = 0
    antiTPToggleFrame.Parent = card

    local antiTPToggleCorner = Instance.new("UICorner")
    antiTPToggleCorner.CornerRadius = UDim.new(0, 8)
    antiTPToggleCorner.Parent = antiTPToggleFrame

    local antiTPToggleLabel = Instance.new("TextLabel")
    antiTPToggleLabel.Name = "AntiTPToggleLabel"
    antiTPToggleLabel.Parent = antiTPToggleFrame
    antiTPToggleLabel.BackgroundTransparency = 1
    antiTPToggleLabel.Position = UDim2.new(0, 12, 0, 0)
    antiTPToggleLabel.Size = UDim2.new(1, -60, 1, 0)
    antiTPToggleLabel.Text = "Anti-TP Scam"
    antiTPToggleLabel.Font = Enum.Font.GothamBold
    antiTPToggleLabel.TextSize = 13
    antiTPToggleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    antiTPToggleLabel.TextXAlignment = Enum.TextXAlignment.Left

    local antiTPToggleButton = Instance.new("TextButton")
    antiTPToggleButton.Name = "AntiTPToggleButton"
    antiTPToggleButton.Parent = antiTPToggleFrame
    antiTPToggleButton.Size = UDim2.new(0, 50, 0, 24)
    antiTPToggleButton.Position = UDim2.new(1, -58, 0.5, -12)
    antiTPToggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 68)
    antiTPToggleButton.Text = ""
    antiTPToggleButton.BorderSizePixel = 0

    local antiTPToggleBtnCorner = Instance.new("UICorner")
    antiTPToggleBtnCorner.CornerRadius = UDim.new(0, 12)
    antiTPToggleBtnCorner.Parent = antiTPToggleButton

    local antiTPToggleIndicator = Instance.new("Frame")
    antiTPToggleIndicator.Name = "Indicator"
    antiTPToggleIndicator.Parent = antiTPToggleButton
    antiTPToggleIndicator.Size = UDim2.new(0, 20, 0, 20)
    antiTPToggleIndicator.Position = UDim2.new(0, 2, 0, 2)
    antiTPToggleIndicator.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
    antiTPToggleIndicator.BorderSizePixel = 0

    local antiTPIndicatorCorner = Instance.new("UICorner")
    antiTPIndicatorCorner.CornerRadius = UDim.new(0, 10)
    antiTPIndicatorCorner.Parent = antiTPToggleIndicator

    local body = Instance.new("Frame")
    body.Name = "Body"
    body.Size = UDim2.new(1, -24, 1, -160)
    body.Position = UDim2.new(0, 12, 0, 156)
    body.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    body.BackgroundTransparency = 0.1
    body.BorderSizePixel = 0
    body.Parent = card

    local bodyCorner = Instance.new("UICorner")
    bodyCorner.CornerRadius = UDim.new(0, 12)
    bodyCorner.Parent = body

    local list = Instance.new("ScrollingFrame")
    list.Name = "PlayersList"
    list.Parent = body
    list.BackgroundTransparency = 1
    list.Size = UDim2.new(1, -16, 1, -16)
    list.Position = UDim2.new(0, 8, 0, 8)
    list.CanvasSize = UDim2.new(0, 0, 0, 0)
    list.ScrollBarThickness = 6

    local layout = Instance.new("UIListLayout")
    layout.Parent = list
    layout.Padding = UDim.new(0, 8)
    layout.SortOrder = Enum.SortOrder.Name

    local template = Instance.new("Frame")
    template.Name = "TemplateRow"
    template.Size = UDim2.new(1, 0, 0, 40)
    template.BackgroundColor3 = Color3.fromRGB(40, 40, 48)
    template.Visible = false
    template.Parent = list

    local templateCorner = Instance.new("UICorner")
    templateCorner.CornerRadius = UDim.new(0, 8)
    templateCorner.Parent = template

    local templateStroke = Instance.new("UIStroke")
    templateStroke.Color = Color3.fromRGB(60, 60, 68)
    templateStroke.Thickness = 1
    templateStroke.Parent = template

    local avatarDot = Instance.new("Frame")
    avatarDot.Name = "AvatarDot"
    avatarDot.Size = UDim2.new(0, 28, 0, 28)
    avatarDot.Position = UDim2.new(0, 8, 0, 6)
    avatarDot.BackgroundTransparency = 1
    avatarDot.Parent = template

    local avatarCorner = Instance.new("UICorner")
    avatarCorner.CornerRadius = UDim.new(0, 14)
    avatarCorner.Parent = avatarDot

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "NameLabel"
    nameLabel.Parent = template
    nameLabel.BackgroundTransparency = 1
    nameLabel.Position = UDim2.new(0, 48, 0, 6)
    nameLabel.Size = UDim2.new(1, -100, 0, 28)
    nameLabel.Font = Enum.Font.Gotham
    nameLabel.TextSize = 14
    nameLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left

    local checkMark = Instance.new("Frame")
    checkMark.Name = "CheckMark"
    checkMark.Parent = template
    checkMark.BackgroundColor3 = Color3.fromRGB(40, 40, 48)
    checkMark.BackgroundTransparency = 0
    checkMark.BorderSizePixel = 0
    checkMark.Position = UDim2.new(1, -38, 0, 6)
    checkMark.Size = UDim2.new(0, 28, 0, 28)
    checkMark.Visible = false

    local checkCorner = Instance.new("UICorner")
    checkCorner.CornerRadius = UDim.new(0, 14)
    checkCorner.Parent = checkMark

    local checkStroke = Instance.new("UIStroke")
    checkStroke.Name = "AnimatedStroke"
    checkStroke.Color = Color3.fromRGB(255, 255, 255)
    checkStroke.Thickness = 2
    checkStroke.Transparency = 0
    checkStroke.Parent = checkMark

    local checkGradient = Instance.new("UIGradient")
    checkGradient.Parent = checkStroke
    checkGradient.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 1),
        NumberSequenceKeypoint.new(0.1, 0),
        NumberSequenceKeypoint.new(0.9, 0),
        NumberSequenceKeypoint.new(1, 1)
    })

    local checkLabel = Instance.new("TextLabel")
    checkLabel.Name = "NumberLabel"
    checkLabel.Parent = checkMark
    checkLabel.BackgroundTransparency = 1
    checkLabel.Size = UDim2.new(1, 0, 1, 0)
    checkLabel.Font = Enum.Font.GothamBold
    checkLabel.TextSize = 16
    checkLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    checkLabel.Text = ""

    local execButton = Instance.new("TextButton")
    execButton.Name = "ExecuteButton"
    execButton.Parent = card
    execButton.Size = UDim2.new(1, -24, 0, 32)
    execButton.Position = UDim2.new(0, 12, 1, -44)
    execButton.BackgroundColor3 = Color3.fromRGB(76, 175, 80)
    execButton.Text = "EXECUTE (F)"
    execButton.Font = Enum.Font.GothamBold
    execButton.TextSize = 14
    execButton.TextColor3 = Color3.fromRGB(255,255,255)
    execButton.BorderSizePixel = 0
    execButton.Visible = UserInputService.TouchEnabled

    local execCorner = Instance.new("UICorner")
    execCorner.CornerRadius = UDim.new(0, 10)
    execCorner.Parent = execButton

    toggleButton.MouseButton1Click:Connect(function()
        autoDefenseEnabled = not autoDefenseEnabled
        
        local targetPos, targetColor, targetIndicatorColor
        if autoDefenseEnabled then
            targetPos = UDim2.new(1, -22, 0, 2)
            targetColor = Color3.fromRGB(76, 175, 80)
            targetIndicatorColor = Color3.fromRGB(255, 255, 255)
        else
            targetPos = UDim2.new(0, 2, 0, 2)
            targetColor = Color3.fromRGB(60, 60, 68)
            targetIndicatorColor = Color3.fromRGB(180, 180, 180)
        end
        
        TweenService:Create(toggleIndicator, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {Position = targetPos}):Play()
        TweenService:Create(toggleButton, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {BackgroundColor3 = targetColor}):Play()
        TweenService:Create(toggleIndicator, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {BackgroundColor3 = targetIndicatorColor}):Play()
    end)

    antiTPToggleButton.MouseButton1Click:Connect(function()
        antiTPScamEnabled = not antiTPScamEnabled
        
        if antiTPScamEnabled and not myPlot then
            myPlot = findMyPlot()
            if myPlot then
                myPlotAnimalPodiums = getMyPlotAnimalPodiums(myPlot)
            else
                antiTPScamEnabled = false
                return
            end
        end
        
        local targetPos, targetColor, targetIndicatorColor
        if antiTPScamEnabled then
            targetPos = UDim2.new(1, -22, 0, 2)
            targetColor = Color3.fromRGB(76, 175, 80)
            targetIndicatorColor = Color3.fromRGB(255, 255, 255)
        else
            targetPos = UDim2.new(0, 2, 0, 2)
            targetColor = Color3.fromRGB(60, 60, 68)
            targetIndicatorColor = Color3.fromRGB(180, 180, 180)
        end
        
        TweenService:Create(antiTPToggleIndicator, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {Position = targetPos}):Play()
        TweenService:Create(antiTPToggleButton, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {BackgroundColor3 = targetColor}):Play()
        TweenService:Create(antiTPToggleIndicator, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {BackgroundColor3 = targetIndicatorColor}):Play()
    end)
    
    local function executeCommands()
        if not remoteReady then
            warn("⚠️ Remote not ready yet")
            return
        end
        
        local allPlayers = Players:GetPlayers()
        local otherPlayers = {}
        
        for _, plr in ipairs(allPlayers) do
            if plr ~= localPlayer then
                table.insert(otherPlayers, plr)
            end
        end
        
        if #otherPlayers == 0 then
            return
        end
        
        if #selectedPlayers > 0 then
            executionCount = executionCount + 1
            local effectIndex = (executionCount - 1) % 3 + 1
            
            if #selectedPlayers == 1 then
                if effectIndex == 1 then
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", selectedPlayers[1], "balloon")
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", selectedPlayers[1], "jail")
                elseif effectIndex == 2 then
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", selectedPlayers[1], "ragdoll")
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", selectedPlayers[1], "inverse")
                elseif effectIndex == 3 then
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", selectedPlayers[1], "rocket")
                end
            elseif #selectedPlayers >= 2 then
                local p1, p2 = selectedPlayers[1], selectedPlayers[2]
                
                if effectIndex == 1 then
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "balloon")
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "jail")
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "ragdoll")
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "inverse")
                elseif effectIndex == 2 then
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "ragdoll")
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "inverse")
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "balloon")
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "jail")
                elseif effectIndex == 3 then
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "rocket")
                    NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "rocket")
                end
            end
        elseif #otherPlayers == 1 then
            executionCount = executionCount + 1
            local effectIndex = (executionCount - 1) % 3 + 1
            
            if effectIndex == 1 then
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", otherPlayers[1], "balloon")
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", otherPlayers[1], "jail")
            elseif effectIndex == 2 then
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", otherPlayers[1], "ragdoll")
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", otherPlayers[1], "inverse")
            elseif effectIndex == 3 then
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", otherPlayers[1], "rocket")
            end
        elseif #otherPlayers >= 2 then
            executionCount = executionCount + 1
            local effectIndex = (executionCount - 1) % 3 + 1
            local p1, p2 = otherPlayers[1], otherPlayers[2]
            
            if effectIndex == 1 then
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "balloon")
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "jail")
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "ragdoll")
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "inverse")
            elseif effectIndex == 2 then
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "ragdoll")
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "inverse")
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "balloon")
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "jail")
            elseif effectIndex == 3 then
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p1, "rocket")
                NetRemote:FireServer("78a772b6-9e1c-4827-ab8b-04a07838f298", p2, "rocket")
            end
        end
    end

    execButton.MouseButton1Click:Connect(executeCommands)
    
    local function cleanupInvalidPlayers()
        local changed = false
        local newSelectedPlayers = {}
        
        local orderedUserIds = {}
        for userId, order in pairs(selectedUserIds) do
            table.insert(orderedUserIds, {userId = userId, order = order})
        end
        table.sort(orderedUserIds, function(a, b) return a.order < b.order end)
        
        for _, data in ipairs(orderedUserIds) do
            local plr = Players:GetPlayerByUserId(data.userId)
            if plr and plr.Parent == Players and plr ~= localPlayer then
                table.insert(newSelectedPlayers, plr)
            else
                selectedUserIds[data.userId] = nil
                changed = true
            end
        end
        
        selectedPlayers = newSelectedPlayers
        
        selectedSet = {}
        for _, plr in ipairs(selectedPlayers) do
            selectedSet[plr] = true
        end
        
        return changed
    end

    local function updateCheckmarks()
        cleanupInvalidPlayers()
        
        for _, r in ipairs(list:GetChildren()) do
            if r:IsA("Frame") and r ~= template then
                local checkFrame = r:FindFirstChild("CheckMark")
                if checkFrame then
                    checkFrame.NumberLabel.Text = ""
                    checkFrame.Visible = false
                end
            end
        end
        
        for i, plr in ipairs(selectedPlayers) do
            if plr and plr.Parent == Players then
                local row = list:FindFirstChild(plr.Name.."_row")
                if row then
                    local checkFrame = row:FindFirstChild("CheckMark")
                    if checkFrame then
                        checkFrame.Visible = true
                        checkFrame.NumberLabel.Text = tostring(i)
                    end
                end
            end
        end
    end

    local function refreshList()
        cleanupInvalidPlayers()
        
        for _, child in ipairs(list:GetChildren()) do
            if child:IsA("Frame") and child ~= template then
                child:Destroy()
            end
        end
        
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= localPlayer then
                local row = template:Clone()
                row.Visible = true
                row.Name = plr.Name.."_row"
                row.Parent = list
                row.NameLabel.Text = plr.DisplayName.." @"..plr.Name
                
                task.spawn(function()
                    local success, thumb = pcall(function()
                        return Players:GetUserThumbnailAsync(plr.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
                    end)
                    
                    if success and thumb and row and row.Parent then
                        row.AvatarDot:ClearAllChildren()
                        local img = Instance.new("ImageLabel")
                        img.Parent = row.AvatarDot
                        img.Size = UDim2.new(1,0,1,0)
                        img.BackgroundTransparency = 1
                        img.Image = thumb
                        
                        local imgCorner = Instance.new("UICorner")
                        imgCorner.CornerRadius = UDim.new(0, 14)
                        imgCorner.Parent = img
                    end
                end)
                
                row.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                        if selectedUserIds[plr.UserId] then
                            selectedUserIds[plr.UserId] = nil
                            selectedSet[plr] = nil
                            for i, p in ipairs(selectedPlayers) do
                                if p == plr then
                                    table.remove(selectedPlayers, i)
                                    break
                                end
                            end
                            
                            for i, p in ipairs(selectedPlayers) do
                                selectedUserIds[p.UserId] = i
                            end
                        else
                            if #selectedPlayers < 2 then
                                local newOrder = #selectedPlayers + 1
                                selectedUserIds[plr.UserId] = newOrder
                                table.insert(selectedPlayers, plr)
                                selectedSet[plr] = true
                            end
                        end
                        updateCheckmarks()
                    end
                end)
            end
        end
        
        updateCheckmarks()
        list.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y+12)
    end
    
    task.spawn(function()
        task.wait(2)
        myPlot = findMyPlot()
        if myPlot then
            myPlotAnimalPodiums = getMyPlotAnimalPodiums(myPlot)
            plotStatus.Text = "Plot: Found ✓"
        else
            plotStatus.Text = "Plot: Not found ❌"
            warn("⚠️ Anti-TP Scam: Could not find plot")
        end
    end)
    
    task.spawn(function()
        while not remoteReady do
            task.wait(0.1)
        end
        task.wait(0.5)
        refreshList()
    end)
    
    Players.PlayerAdded:Connect(function()
        task.wait(0.5)
        refreshList()
    end)

    Players.PlayerRemoving:Connect(function(removedPlayer)
        selectedUserIds[removedPlayer.UserId] = nil
        selectedSet[removedPlayer] = nil
        for i = #selectedPlayers, 1, -1 do
            if selectedPlayers[i] == removedPlayer then
                table.remove(selectedPlayers, i)
            end
        end
        refreshList()
    end)

    localPlayer.CharacterAdded:Connect(function()
        task.wait(1)
        refreshList()
    end)
    
    local dragging = false
    local dragStart, startPos
    
    local function update(input)
        local delta = input.Position - dragStart
        outer.Position = UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
    end

    topLeftAccent.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = outer.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            update(input)
        end
    end)
end)
